#!/bin/bash
HOST_NAME="<%= @cmkserver %>"
SITE_NAME="cmk"
API_URL="http://$HOST_NAME/$SITE_NAME/check_mk/api/1.0"
USERNAME="automation"
PASSWORD="<%= @apitoken %>"

http POST "$API_URL/domain-types/host_config/collections/all" \
  "Authorization: Bearer $USERNAME $PASSWORD" \
  "Accept: application/json" \
  'Content-Type:application/json' \
  folder='/' \
  host_name='<%= @agenthostname %>' \
  attributes='{'ipaddress': '<%= @agentip %>'}'
